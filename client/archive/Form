import { useEffect } from "react";
import useForm from "../../../global/utils/useForm";
import Button from "../../atoms/Button";
import TextField from "../../atoms/TextField";
import { Form, LoginFormHeading, LoginFormWrapper } from "./LoginForm.styles";

const LoginForm = () => {
  const { inputValues, handleChange, setError } = useForm({
    initialFormValues: {
      email: "",
      password: "",
    },
  });
  const { email, password, errors } = inputValues;

  useEffect(() => {
    const error = validateEmail(email);
    if (error) {
      setError("email", error);
    }
  }, [email]);

  useEffect(() => {
    const error = validatePassword(password);
    if (error) {
      setError("password", error);
    }
  }, [password]);

  const validateEmail = (value) => {
    let error;
    if (!value) {
      error = "Please enter the email address.";
    } else if (!value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)) {
      error = "Please enter a valid email address.";
    } else {
      error = undefined;
    }
    return error;
  };

  const validatePassword = (value) => {
    let error;
    if (!value) {
      error = "Please enter a password.";
    } else {
      error = undefined;
    }
    return error;
  };

  const isError = () => {
    console.log({ errors });
    return Object.values(errors).find((value) => value && value !== undefined);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    const error = isError();
    if (!error) {
      console.log({ email, password, errors });
    }
  };

  return (
    <LoginFormWrapper>
      <LoginFormHeading>
        <h1>Login</h1>
        <p>Get access to your Orders, Wishlist and Recommendations.</p>
      </LoginFormHeading>
      <Form onSubmit={handleSubmit}>
        <TextField
          id="email"
          name="email"
          type="email"
          labelText="Email"
          error={errors.email}
          onChange={handleChange}
        />
        <TextField
          id="password"
          name="password"
          type="password"
          labelText="Password"
          error={errors.password}
          onChange={handleChange}
        />
        <Button
          id="submit"
          name="submit"
          disabled={!email || !password || isError()}
        >
          Login
        </Button>
      </Form>
    </LoginFormWrapper>
  );
};

export default LoginForm;
